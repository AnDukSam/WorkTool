<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì¹´í†¡ í–‰ì‚¬ ê´€ë¦¬ì</title>
    <style>
        * { box-sizing: border-box; }
        body { padding: 0 15px 40px 15px; margin: 0; font-family: 'Malgun Gothic', sans-serif; background-color: #f5f5f5; }
        .main-title { text-align: center; padding: 20px 0; margin: 0 -15px 20px -15px; background: linear-gradient(135deg, #4CAF50, #2E7D32); color: white; font-size: 20px; font-weight: bold; box-shadow: 0 2px 10px rgba(0,0,0,0.1); letter-spacing: 1px; }

        /* í’ˆëª© í¸ì§‘ ì˜ì—­ */
        .admin-section { background: #333; color: white; padding: 10px; border-radius: 8px; margin-bottom: 15px; display: none; }
        .admin-section textarea { width: 100%; height: 200px; margin-top: 10px; font-size: 14px; padding: 10px; border-radius: 5px; border: none; line-height: 1.5; }
        .admin-btn-group { display: flex; gap: 5px; margin-top: 10px; }
        .admin-btn { flex: 1; padding: 8px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        #saveListBtn { background: #4CAF50; color: white; }
        #toggleAdminBtn { background: #666; color: white; width: 100%; padding: 8px; border-radius: 8px; border: none; margin-bottom: 10px; font-size: 13px; }

        .option-container { background: #fff; padding: 18px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border: 1px solid #e0e0e0; }
        .date-section { display: flex; flex-direction: column; gap: 12px; }
        .date-row { display: flex; align-items: center; justify-content: space-between; gap: 8px; }
        .date-label { font-weight: bold; font-size: 14px; color: #333; display: flex; align-items: center; gap: 5px; min-width: 80px; }
        .date-controls { display: flex; align-items: center; gap: 6px; }
        .date-btn { width: 36px; height: 36px; font-size: 18px; background-color: #f8f8f8; border: 1px solid #ddd; border-radius: 8px; cursor: pointer; color: #333; }
        .small-input { width: 50px; height: 36px; text-align: center; font-size: 16px; border: 1px solid #ddd; border-radius: 8px; font-weight: bold; color: #2E7D32; }
        .unit-text { font-size: 14px; color: #666; min-width: 50px; }
        .no-price-mode { display: flex; align-items: center; justify-content: center; gap: 8px; border-top: 1px solid #eee; margin-top: 12px; padding-top: 12px; }
        .no-price-mode input[type="checkbox"] { width: 18px; height: 18px; accent-color: #4CAF50; }
        .no-price-mode label { font-size: 14px; font-weight: bold; color: #555; cursor: pointer; }

        #container { display: flex; flex-direction: column; gap: 12px; margin-bottom: 25px; }
        .row { background-color: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); display: flex; flex-wrap: wrap; gap: 8px; position: relative; transition: background-color 0.3s ease; }
        .row.completed { background-color: #fff9c4; border: 1px solid #ffe082; }
        .row-header { width: 100%; display: flex; align-items: center; justify-content: space-between; margin-bottom: 5px; }
        .row-number { font-weight: bold; color: #4CAF50; font-size: 14px; }
        .manual-input-box { display: flex; align-items: center; gap: 4px; font-size: 12px; color: #666; cursor: pointer; }

        select, input { height: 45px; padding: 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 15px; }
        .product-select, .product-manual { width: 100%; }
        .unit-select { flex: 1; min-width: 85px; }
        .normal-price, .sale-price { flex: 1; min-width: 95px; }

        .hide-normal-price .normal-price { display: none; }
        .controls { display: flex; gap: 4px; }
        .control-btn { padding: 6px 10px; border-radius: 6px; border: 1px solid #ddd; font-size: 14px; cursor: pointer; background: #fff; color: #333; }
        .del-btn { background-color: #ff5252; color: white; border: none; }

        .header { display: flex; gap: 10px; margin-bottom: 20px; }
        .header button { flex: 1; height: 50px; font-size: 16px; border-radius: 10px; border: none; font-weight: bold; }
        #plusBtn { background-color: #4CAF50; color: white; }
        #extractBtn { background-color: #2196F3; color: white; }

        #resultArea { margin-top: 20px; padding: 15px; background-color: #fff; border: 2px dashed #4CAF50; border-radius: 10px; white-space: pre-wrap; font-size: 14px; display: none; }
        #copyBtn { background-color: #333; color: white; margin-top: 15px; width: 100%; height: 55px; display: none; border: none; border-radius: 10px; font-size: 17px; font-weight: bold; }
    </style>
</head>
<body>

    <div class="main-title">ì¹´í†¡ í–‰ì‚¬</div>

    <button id="toggleAdminBtn">âš™ï¸ í’ˆëª© ë¦¬ìŠ¤íŠ¸ í¸ì§‘ (ì§ì ‘ ìˆ˜ì •)</button>
    <div class="admin-section" id="adminSection">
        <div style="font-size: 12px; color: #bbb;">í•œ ì¤„ì— í•˜ë‚˜ì”© í’ˆëª©ëª…ì„ ì ì–´ì£¼ì„¸ìš”. ì¹´í…Œê³ ë¦¬ëŠ” ğŸŸ¥ğŸŸ¥ ê¸°í˜¸ë¥¼ í¬í•¨í•˜ì„¸ìš”.</div>
        <textarea id="rawProductList"></textarea>
        <div class="admin-btn-group">
            <button id="saveListBtn" class="admin-btn">ì €ì¥ ë° ì ìš©</button>
        </div>
    </div>

    <div class="option-container">
        <div class="date-section">
            <div class="date-row">
                <span class="date-label">ğŸ“… ì‹œì‘ì¼</span>
                <div class="date-controls">
                    <button class="date-btn" id="startMinus">-</button>
                    <input type="number" id="startOffset" class="small-input" value="0">
                    <button class="date-btn" id="startPlus">+</button>
                    <span class="unit-text">ì¼ í›„ë¶€í„°</span>
                </div>
            </div>
            <div class="date-row">
                <span class="date-label">â±ï¸ ê¸°ê°„</span>
                <div class="date-controls">
                    <button class="date-btn" id="durationMinus">-</button>
                    <input type="number" id="durationInput" class="small-input" value="1">
                    <button class="date-btn" id="durationPlus">+</button>
                    <span class="unit-text">ì¼ê°„ ì§„í–‰</span>
                </div>
            </div>
        </div>
        <div class="no-price-mode">
            <input type="checkbox" id="noNormalPrice">
            <label for="noNormalPrice">ì •ìƒê°€ ìƒëµ ëª¨ë“œ (íŒë§¤ê°€ë§Œ ì¶”ì¶œ)</label>
        </div>
    </div>

    <div id="container"></div>

    <div class="header">
        <button id="plusBtn">í’ˆëª© ì¶”ê°€</button>
        <button id="extractBtn">í…ìŠ¤íŠ¸ ì¶”ì¶œ</button>
    </div>

    <div id="resultArea"></div>
    <button id="copyBtn">ğŸ“‹ í…ìŠ¤íŠ¸ ë³µì‚¬</button>

    <script>
        // ê¸°ë³¸ í’ˆëª© ë°ì´í„° (ë¡œì»¬ ì €ì¥ì†Œì— ì—†ì„ ë•Œ ì‚¬ìš©)
        const defaultProducts = [
            "í•œìš° ê³°íƒ•", "í•œìš° êµ­ê±°ë¦¬", "í•œìš° ê½ƒë“±ì‹¬", "í•œìš° ë¶ˆê³ ê¸°ìš©", "í•œìš° ìœ¡íšŒ", "í•œìš° ìœ¡íšŒ(ì†ŒìŠ¤ í¬í•¨)", "í•œìš° ì±„ëë“±ì‹¬", "ğŸŸ¥ğŸŸ¥ í•œìš° ğŸŸ¥ğŸŸ¥",
            "1+ í•œìš° êµ­ê±°ë¦¬", "1+ í•œìš° ê½ƒë“±ì‹¬", "1+ í•œìš° ìœ¡íšŒ", "1+ í•œìš° ìœ¡íšŒ(ì†ŒìŠ¤ í¬í•¨)", "1+ í•œìš° ì±„ëë“±ì‹¬", "ğŸŸ¥ğŸŸ¥ 1+ í•œìš° ğŸŸ¥ğŸŸ¥",
            "í•œëˆ ê°ˆë¹„", "í•œëˆ ë“±ê°ˆë¹„", "í•œëˆ ë“±ë¼ˆ", "í•œëˆ ëª©ì‚´", "í•œëˆ ì‚¬íƒœ", "í•œëˆ ì‚¼ê²¹ì‚´", "í•œëˆ ì•ë‹¤ë¦¬ì‚´(ìˆ˜ìœ¡ìš©)", "ğŸŸ¥ğŸŸ¥ í•œëˆ ğŸŸ¥ğŸŸ¥",
            "ëŒ€íŒ¨ì‚¼ê²¹ì‚´(êµ­ë‚´ì‚°)", "ëŒ€íŒ¨ì‚¼ê²¹ì‚´(ìˆ˜ì…ì‚°)", "ëŒ€íŒ¨ì‚¼ê²¹ì‚´(ì¹ ë ˆì‚°)", "ìš°ì‚¼ê²¹(ë¯¸êµ­ì‚°)", "ì°¨ëŒë°•ì´(ìˆ˜ì…ì‚°)", "ğŸŸ¥ğŸŸ¥ ëŒ€íŒ¨ë¥˜ ğŸŸ¥ğŸŸ¥",
            "ì–‘ë… ë¼ì§€ê°ˆë¹„", "ë¶ì„±ë¡œ ë¶ˆê³ ê¸°", "ë¼ˆì—†ëŠ” ë‹­ê°ˆë¹„", "ê³ ì¶”ì¥ ë¶ˆê³ ê¸°", "ì–‘ë… ì†Œë¶ˆê³ ê¸°", "ì–‘ë… LAê°ˆë¹„", "LAê°ˆë¹„ì‹ ì–‘ë… ë¼ì§€ê°ˆë¹„", "ë‹¤í–¥ í›ˆì œì˜¤ë¦¬", "ë‹­ë°œ í¸ìœ¡", "ì–‘ë… í¸ìœ¡", "ë¬´ë¼ˆ ì–‘ë…ë‹­ë°œ", "í‘ë§ˆëŠ˜ ì˜¤ë¦¬í›ˆì œ", "ğŸŸ¥ğŸŸ¥ ë°€í‚¤íŠ¸ ğŸŸ¥ğŸŸ¥",
            "í•˜ë¦¼ ìƒë‹­(11í˜¸)", "í•˜ë¦¼ ìƒë‹­(13í˜¸)", "í•˜ë¦¼ ì˜ê³„", "í•˜ë¦¼ í† ì¢…ë‹­", "ğŸŸ¥ğŸŸ¥ ë‹­ ğŸŸ¥ğŸŸ¥"
        ];

        let currentProductList = JSON.parse(localStorage.getItem('meatProducts')) || defaultProducts;

        const container = document.getElementById('container');
        const plusBtn = document.getElementById('plusBtn');
        const extractBtn = document.getElementById('extractBtn');
        const copyBtn = document.getElementById('copyBtn');
        const resultArea = document.getElementById('resultArea');
        const startOffsetInput = document.getElementById('startOffset');
        const durationInput = document.getElementById('durationInput');
        const noNormalPriceCheck = document.getElementById('noNormalPrice');

        const adminSection = document.getElementById('adminSection');
        const rawProductList = document.getElementById('rawProductList');
        const toggleAdminBtn = document.getElementById('toggleAdminBtn');
        const saveListBtn = document.getElementById('saveListBtn');

        // ê´€ë¦¬ì ëª¨ë“œ í† ê¸€
        toggleAdminBtn.onclick = () => {
            const isVisible = adminSection.style.display === 'block';
            adminSection.style.display = isVisible ? 'none' : 'block';
            if (!isVisible) rawProductList.value = currentProductList.join('\n');
        };

        // í’ˆëª© ë¦¬ìŠ¤íŠ¸ ì €ì¥
        saveListBtn.onclick = () => {
            const newList = rawProductList.value.split('\n').map(item => item.trim()).filter(item => item !== "");
            currentProductList = newList;
            localStorage.setItem('meatProducts', JSON.stringify(newList));
            alert('í’ˆëª© ë¦¬ìŠ¤íŠ¸ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ìŒ í’ˆëª© ì¶”ê°€ë¶€í„° ì ìš©ë©ë‹ˆë‹¤.');
            adminSection.style.display = 'none';
        };

        const unitList = ['100g', '1íŒ©', '1ë´‰(600g ì´ìƒ)', '1í†µ', '1ë§ˆë¦¬', '2ë§ˆë¦¬'];

        function getCircleNum(n) {
            const circleNums = ["â‘ ","â‘¡","â‘¢","â‘£","â‘¤","â‘¥","â‘¦","â‘§","â‘¨","â‘©","â‘ª","â‘«","â‘¬","â‘­","â‘®","â‘¯","â‘°","â‘±","â‘²","â‘³","ã‰‘","ã‰’","ã‰“","ã‰”","ã‰•","ã‰–","ã‰—","ã‰˜","ã‰™","ã‰š","ã‰›","ã‰œ","ã‰","ã‰","ã‰Ÿ","ãŠ±","ãŠ²","ãŠ³","ãŠ´","ãŠµ","ãŠ¶","ãŠ·","ãŠ¸","ãŠ¹","ãŠº","ãŠ»","ãŠ¼","ãŠ½","ãŠ¾","ãŠ¿"];
            return circleNums[n - 1] || `${n})`;
        }

        function getEventDateText(offset, duration) {
            const week = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            const start = new Date();
            start.setDate(start.getDate() + offset);
            const end = new Date(start);
            end.setDate(end.getDate() + (duration - 1));
            const fmtDate = (d) => `${d.getFullYear()}ë…„ ${d.getMonth() + 1}ì›” ${d.getDate()}ì¼ (${week[d.getDay()]})`;
            const fmtShortDate = (d) => `${d.getMonth() + 1}ì›” ${d.getDate()}ì¼ (${week[d.getDay()]})`;
            if (duration === 1) return `ğŸ“¢ ì •ìœ¡ ì¹´í†¡ í–‰ì‚¬ - ${fmtDate(start)}`;
            const startTxt = fmtDate(start);
            const endTxt = (start.getMonth() === end.getMonth()) ? `${end.getDate()}ì¼ (${week[end.getDay()]})` : fmtShortDate(end);
            return `ğŸ“¢ ì •ìœ¡ ì¹´í†¡ í–‰ì‚¬ - ${startTxt} ~ ${endTxt}`;
        }

        function updateNumbers() {
            container.querySelectorAll('.row').forEach((el, idx) => {
                el.querySelector('.row-number').textContent = `í’ˆëª© ${idx + 1}`;
            });
        }

        function checkCompletion(row) {
            const isNoNormal = noNormalPriceCheck.checked;
            const normVal = row.querySelector('.normal-price').value;
            const saleVal = row.querySelector('.sale-price').value;
            let isComplete = isNoNormal ? (saleVal !== "") : (normVal !== "" && saleVal !== "");
            if (isComplete) row.classList.add('completed');
            else row.classList.remove('completed');
        }

        noNormalPriceCheck.addEventListener('change', () => {
            if (noNormalPriceCheck.checked) container.classList.add('hide-normal-price');
            else container.classList.remove('hide-normal-price');
            container.querySelectorAll('.row').forEach(row => checkCompletion(row));
        });

        plusBtn.onclick = () => {
            const row = document.createElement('div');
            row.className = 'row';
            let targetItem = currentProductList[0];
            const lastRow = container.lastElementChild;
            if (lastRow) {
                const sel = lastRow.querySelector('.product-select');
                if(sel){
                    let lastIdx = currentProductList.indexOf(sel.value);
                    if (lastIdx !== -1) {
                        let nextIdx = (lastIdx + 1) % currentProductList.length;
                        while(currentProductList[nextIdx] && currentProductList[nextIdx].includes("ğŸŸ¥ğŸŸ¥")) {
                            nextIdx = (nextIdx + 1) % currentProductList.length;
                        }
                        targetItem = currentProductList[nextIdx];
                    }
                }
            }

            row.innerHTML = `
                <div class="row-header">
                    <div class="row-number-box">
                        <span class="row-number"></span>
                        <label class="manual-input-box"><input type="checkbox" class="manual-check"> ì§ì ‘ ì…ë ¥</label>
                    </div>
                    <div class="controls">
                        <button class="control-btn up-btn">â†‘</button>
                        <button class="control-btn down-btn">â†“</button>
                        <button class="control-btn del-btn">ì‚­ì œ</button>
                    </div>
                </div>
                <div style="width:100%" class="product-input-area">
                    <select class="product-select">
                        ${currentProductList.map(item => `<option value="${item}" ${item.includes('ğŸŸ¥ğŸŸ¥') ? 'disabled' : ''} ${item === targetItem ? 'selected' : ''}>${item}</option>`).join('')}
                    </select>
                </div>
                <select class="unit-select">${unitList.map(u => `<option value="${u}">${u}</option>`).join('')}</select>
                <input type="number" class="normal-price" placeholder="ì •ìƒê°€">
                <input type="number" class="sale-price" placeholder="íŒë§¤ê°€">
            `;

            const manualCheck = row.querySelector('.manual-check');
            const inputArea = row.querySelector('.product-input-area');
            manualCheck.onchange = () => {
                if (manualCheck.checked) inputArea.innerHTML = `<input type="text" class="product-manual" placeholder="ìƒí’ˆëª… ì§ì ‘ ì…ë ¥">`;
                else inputArea.innerHTML = `<select class="product-select">${currentProductList.map(item => `<option value="${item}" ${item.includes('ğŸŸ¥ğŸŸ¥') ? 'disabled' : ''}>${item}</option>`).join('')}</select>`;
            };

            row.addEventListener('input', () => checkCompletion(row));
            row.querySelector('.del-btn').onclick = () => { row.remove(); updateNumbers(); };
            row.querySelector('.up-btn').onclick = () => { if (row.previousElementSibling) { container.insertBefore(row, row.previousElementSibling); updateNumbers(); } };
            row.querySelector('.down-btn').onclick = () => { if (row.nextElementSibling) { container.insertBefore(row.nextElementSibling, row); updateNumbers(); } };

            container.appendChild(row);
            updateNumbers();
            row.scrollIntoView({ behavior: 'smooth', block: 'start' });
        };

        extractBtn.onclick = () => {
            const rows = container.querySelectorAll('.row');
            if (!rows.length) return alert("í’ˆëª©ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.");
            const isNoNormal = noNormalPriceCheck.checked;
            let resultText = getEventDateText(parseInt(startOffsetInput.value), parseInt(durationInput.value)) + "\n\n";

            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                const manualCheck = row.querySelector('.manual-check').checked;
                const prod = manualCheck ? row.querySelector('.product-manual').value : row.querySelector('.product-select').value;
                const unit = row.querySelector('.unit-select').value;
                const norm = row.querySelector('.normal-price').value;
                const sale = row.querySelector('.sale-price').value;

                if (!prod) { alert(`${i+1}ë²ˆ ìƒí’ˆëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.`); return; }
                if (!isNoNormal && !norm) { alert(`${i+1}ë²ˆ ì •ìƒê°€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.`); return; }
                if (!sale) { alert(`${i+1}ë²ˆ íŒë§¤ê°€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.`); return; }

                const fmt = (n) => Number(n).toLocaleString();
                resultText += isNoNormal ? `${getCircleNum(i + 1)} ${prod} ${unit} ${fmt(sale)}ì›\n` : `${getCircleNum(i + 1)} ${prod} ${unit} ${fmt(norm)}ì› â ${fmt(sale)}ì›\n`;
            }

            resultArea.textContent = resultText.trim();
            resultArea.style.display = "block";
            copyBtn.style.display = "block";
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        };

        copyBtn.onclick = () => {
            const text = resultArea.textContent;
            navigator.clipboard.writeText(text).then(() => alert("ë³µì‚¬ ì™„ë£Œ!")).catch(() => {
                const t = document.createElement("textarea");
                t.value = text; document.body.appendChild(t); t.select();
                document.execCommand('copy'); document.body.removeChild(t);
                alert("ë³µì‚¬ ì™„ë£Œ!");
            });
        };

        document.getElementById('startMinus').onclick = () => { if(startOffsetInput.value > 0) startOffsetInput.value--; };
        document.getElementById('startPlus').onclick = () => { startOffsetInput.value++; };
        document.getElementById('durationMinus').onclick = () => { if(durationInput.value > 1) durationInput.value--; };
        document.getElementById('durationPlus').onclick = () => { durationInput.value++; };

        window.onload = () => plusBtn.click();
    </script>
</body>
</html>